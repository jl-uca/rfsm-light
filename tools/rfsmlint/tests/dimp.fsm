fsm model dimp(
  in e: bool,
  in h: event,
  out s: bool
  )
{
  states: E0 where s=0, E1 where s=0, E2 where s=1;
  vars: k: int;
  trans:   
  | E0 -> E1 on h when e=1 with k:=1  
  | E1 -> E2 on h when e=0 with k:=2*k-1  
  | E2 -> E0 on h when k=0  
  | E1 -> E1 on h when e=1 with k:=k+1  
  | E2 -> E2 on h when k>0 with k:=k-1;
  itrans: 
  | -> E0;
}